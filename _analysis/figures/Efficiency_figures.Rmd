---
title: "Untitled"
author: "Caitie"
date: '2022-04-20'
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(ggplot2)
library(patchwork)
library(tidyverse)
library(ggrepel)
library(ggpmisc)
```

# Animal PNGs

```{r}
chicken_png <- readPNG(here("_analysis/figures", "chicken.png"))
chicken_png <- rasterGrob(chicken_png)
```

```{r}
salmon_png<-readPNG(here("_analysis/figures", "salmon.png"))
salmon_png<-rasterGrob(salmon_png)
```

# Data
```{r}
dat<-read.csv(here("_analysis/output_data/CPI_cells_by_country.csv"))
```

Chicken CPI vs CPI footprint

```{r}
dat<-dat %>% 
  mutate(broiler_cpi_pixel_lab = ifelse(broiler_cells>50000 | chicken_cpi > 0.1, as.character(Country), NA))

my.formula <- y ~ x

chick_cpi_km2_plot<-ggplot(dat, aes(x = broiler_cells/100000, y = chicken_cpi, label = broiler_cpi_pixel_lab)) + 
  #annotation_custom(chicken_png, xmin = -0.5, xmax = 1, ymin = 0.65, ymax=0.75) +
  geom_point() +
  #geom_smooth(method = "lm", se=FALSE, color="lightblue", formula = my.formula) +
  #stat_poly_eq(formula = my.formula, 
  #              aes(label = paste(..rr.label.., sep = "~~~")), 
  #              parse = TRUE) +
  geom_text_repel() + 
  theme_bw() +
  xlab("Pixels (hundred thousands)") +
  ylab("") 

chick_cpi_km2_plot
```
Chicken CPI vs production


```{r}
dat<-dat %>% 
  mutate(broiler_cpi_prod_lab = ifelse(broiler_slaughter_wt_tonnes>240000000 | chicken_cpi > 0.07, as.character(Country), NA))

chick_cpi_prod_plot<-ggplot(dat, aes(x = broiler_slaughter_wt_tonnes/1000000, y = chicken_cpi, label = broiler_cpi_prod_lab)) +
  #annotation_custom(chicken_png, xmin = 0, xmax = 2.5, ymin = 0.65, ymax=0.75) +
  geom_point() +
  #geom_smooth(method = "lm", se=FALSE, color="lightblue", formula = my.formula) +
  #stat_poly_eq(formula = my.formula, 
  #              aes(label = paste(..rr.label.., sep = "~~~")), 
  #              parse = TRUE) +
  geom_text_repel() + 
  theme_bw() +
  xlab("Slaughter weight (million tonnes)") +
  ylab("") 

chick_cpi_prod_plot
```

Salmon CPI per footprint

```{r}
dat<-dat %>% 
  mutate(salmon_cpi_pixel_lab = ifelse(salmon_cells>24000 | salmon_cpi > 0.005, as.character(Country), NA))

salmon_cpi_km2_plot<-ggplot(dat, aes(x = salmon_cells/100000, y = salmon_cpi, label = salmon_cpi_pixel_lab)) +
 # annotation_custom(salmon_png, xmin = 0, xmax = 0.35, ymin = 0.035, ymax=0.045) +
  geom_point() +
  #geom_smooth(method = "lm", se=FALSE, color="lightblue", formula = my.formula) +
  #stat_poly_eq(formula = my.formula, 
  #              aes(label = paste(..rr.label.., sep = "~~~")), 
  #              parse = TRUE) +
  geom_text_repel() + 
  theme_bw() +
  xlab("Pixels (hundred thousands)") +
  ylab("") 

salmon_cpi_km2_plot
```
 Salmon CPI vs production
 
```{r}
salmon_cpi_prod_plot<-ggplot(dat, aes(x = fao_tonnes_production/10000, y = salmon_cpi, label = Country)) +
  #annotation_custom(salmon_png, xmin = 0, xmax = 20, ymin = 0.035, ymax=0.045) +
  geom_point() +
  #geom_smooth(method = "lm", se=FALSE, color="lightblue", formula = my.formula) +
  #stat_poly_eq(formula = my.formula, 
  #              aes(label = paste(..rr.label.., sep = "~~~")), 
  #              parse = TRUE) +
  geom_text_repel() + 
  theme_bw() +
  xlab("Slaughter weight (ten thounsand tonnes)") +
  ylab("") 

salmon_cpi_prod_plot
```

```{r}
(chick_cpi_prod_plot + chick_cpi_km2_plot)/(salmon_cpi_prod_plot + salmon_cpi_km2_plot) +  plot_annotation(tag_levels = 'A')
```

```{r}
ggsave(here("_analysis/figures/Efficiency_figures.png"), dpi = 300, height = 7, width = 10)
```

